<h1 class="text-3xl font-bold mb-6"><%= @event.title %></h1>

<div class="prose prose-lg max-w-none">
  <h2 class="text-2xl font-semibold mb-4">About</h2>
  <%= render_rich_text_with_embeds(@event.description) %>
</div>

<div>
  <h2 class="text-2xl font-semibold mb-4">Participants</h2>
  <%= render partial: "events/invitation_status", locals: { event: @event } %>
</div>

<h2 class="text-2xl font-semibold mb-4">Add Friends to Event</h2>
<ul class="list-none space-y-26">
  <% @friends.each do |friend| %>
    <li class="mb-2">
      <%= friend.first_name %> <%= friend.last_name %> (<%= friend.tag %>)
      <div class="flex space-x-4">
        <%= button_to 'Add as Attending', add_friend_event_path(@event, friend_id: friend.id, rsvp_status: 'accepted'), method: :post, class: "bg-accent-red text-white px-4 py-2 rounded hover:bg-red-600" %>
        <%= button_to 'Add as Maybe', add_friend_event_path(@event, friend_id: friend.id, rsvp_status: 'pending'), method: :post, class: "bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400" %>
      </div>
    </li>
  <% end %>
</ul>

<% if @event.visibility == "friends" && current_user.friends.include?(@event.user) %>
  <%= button_to "Join Event", update_participation_status_event_path(@event, status: "accepted"), 
      method: :patch, class: "bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" %>
<% end %>

<%= form_with model: [@event, EventSuggestion.new], local: true do |form| %>
  <div class="mb-4">
    <%= form.label :suggested_start_time, 'Suggest New Start Time', class: 'block text-gray-700 font-bold mb-2' %>
    <%= form.text_field :suggested_start_time, class: 'datepicker w-full border border-gray-300 rounded px-4 py-2' %>
  </div>

  <div class="mb-4">
    <%= form.label :suggested_end_time, 'Suggest New End Time', class: 'block text-gray-700 font-bold mb-2' %>
    <%= form.text_field :suggested_end_time, class: 'datepicker w-full border border-gray-300 rounded px-4 py-2' %>
  </div>

  <%= form.submit 'Submit Suggestion', class: 'bg-accent-red text-white px-4 py-2 rounded hover:bg-red-600' %>
<% end %>

<h3 class="text-xl font-bold mt-6">Suggestions</h3>
<% @event.event_suggestions.each do |suggestion| %>
  <div class="p-4 border rounded-lg mb-4">
    <p>Suggested by: <%= suggestion.user.full_name %></p>
    <p>Start Time: <%= suggestion.suggested_start_time %></p>
    <p>End Time: <%= suggestion.suggested_end_time %></p>
    <p>Status: <%= suggestion.status.capitalize %></p>

    <% if current_user == @event.user && suggestion.pending? %>
      <%= link_to 'Approve', event_event_suggestion_path(@event, suggestion, status: 'approved'), method: :patch, class: 'text-green-500' %>
      <%= link_to 'Reject', event_event_suggestion_path(@event, suggestion, status: 'rejected'), method: :patch, class: 'text-red-500 ml-4' %>
    <% end %>
  </div>
<% end %>

<h2>Invite Groups</h2>
<ul>
  <% current_user.groups.each do |group| %>
    <li>
      <%= group.name %>
      <%= button_to "Invite Group", invite_group_event_path(@event, group_id: group.id),
                    method: :post,
                    class: "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" %>
    </li>
  <% end %>
</ul>


<%= link_to 'Back to Events', events_path %>

<div id="calendar"></div>