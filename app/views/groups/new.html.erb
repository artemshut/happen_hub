<h1 class="text-3xl font-bold mb-6">Create a New Group</h1>

<%= form_with model: @group, local: true, class: "space-y-6" do |f| %>
  <div class="mb-4">
    <%= f.label :name, "Group Name", class: "block text-gray-700 font-bold mb-2" %>
    <%= f.text_field :name, required: true, class: "w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-accent-red" %>
  </div>

  <div class="mb-4">
    <%= f.label :description, "Description", class: "block text-gray-700 font-bold mb-2" %>
    <%= f.text_area :description, rows: 3, class: "w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-accent-red" %>
  </div>

  <div class="mb-4">
    <%= f.label :friend_ids, "Add Friends to Group", class: "block text-gray-700 font-bold mb-2" %>
    <%= text_field_tag :friend_search, "", placeholder: "Search friends...", class: "w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-accent-red", data: { action: "input->friend-search#filter" } %>

    <div class="mt-4 border border-gray-300 rounded p-4 max-h-40 overflow-y-auto" data-controller="friend-search">
      <% @friends.each do |friend| %>
        <div class="friend-item mb-2" data-friend-search-target="friend" data-name="<%= friend.first_name.downcase + ' ' + friend.last_name.downcase %>">
          <label class="inline-flex items-center">
            <%= check_box_tag "group[friend_ids][]", friend.id, false, class: "hidden-checkbox", data: { action: "change->friend-search#select" } %>
            <span class="ml-2 text-gray-700 cursor-pointer hover:text-accent-red"><%= friend.first_name %> <%= friend.last_name %> (<%= friend.tag %>)</span>
          </label>
        </div>
      <% end %>
    </div>
  </div>

  <div class="text-right">
    <%= f.submit "Create Group", class: "bg-accent-red text-white px-6 py-2 rounded hover:bg-red-600" %>
  </div>
<% end %>

<script>
  document.addEventListener("turbo:load", () => {
    const searchInput = document.querySelector("[data-action='input->friend-search#filter']");
    const friends = document.querySelectorAll("[data-friend-search-target='friend']");

    searchInput.addEventListener("input", () => {
      const query = searchInput.value.toLowerCase();
      friends.forEach(friend => {
        const name = friend.dataset.name;
        if (name.includes(query)) {
          friend.style.display = "block";
        } else {
          friend.style.display = "none";
        }
      });
    });
  });
</script>